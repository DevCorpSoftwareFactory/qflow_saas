{
  "meta": {
    "project": "QFlow Pro Ecosystem",
    "date": "2026-01-14",
    "prepared_by": "Generated by DevCorp"
  },
  "product_overview": "QFlow Pro is a comprehensive SaaS ERP platform tailored for multi-tenant enterprise distribution businesses like Quesera D&G. It facilitates management across three integrated platforms: the Admin SaaS platform for QFlow Pro's team, the Enterprise Portal for business clients, and the B2B Client App for end customers. The system supports advanced features including license and subscription management, multi-branch operations, inventory traceability by lot, offline operations, hierarchical product catalog with pricing strategies, financial accounting compliant with Colombian standards, robust role-based access control, and detailed business analytics.",
  "core_goals": [
    "Enable efficient multi-tenant SaaS management with strict data isolation.",
    "Provide robust subscription license lifecycle management including activation, renewal, suspension, and cancellation.",
    "Support independent operations for branches including inventory, accounting, and cash control.",
    "Ensure traceability and FIFO management of inventory lots.",
    "Facilitate seamless ordering and payment processing for B2B clients with credit and payment verification.",
    "Implement secure, granular role-based access controls conforming to least privilege principles.",
    "Guarantee offline-first capabilities with reliable local caching and synchronization.",
    "Automate comprehensive financial accounting processes compliant with Colombian tax regulations.",
    "Provide deep business insights and KPIs for operational, financial, and customer analysis."
  ],
  "key_features": [
    "Multi-platform architecture: Admin SaaS, Enterprise Portal, Client B2B App.",
    "License management with trial, commercial plans, upgrades, downgrades, suspensions, and cancellation flows.",
    "Multi-tenancy with Row-Level Security ensuring tenant and branch data segregation.",
    "Hierarchical catalog including products, variants, categories, brands, and units of measure.",
    "Dynamic pricing with price lists per customer type and volume discounts.",
    "Inventory management with FIFO lot traceability and reception of partial purchases.",
    "Corporate supplies management distinguishing owner supplies from external purchases.",
    "Simplified cash control model supporting daily blind reconciliation without individual sales tickets.",
    "Client portal supporting registration, approval workflows, order creation, payment registration, and status tracking.",
    "Role-based access control matrix covering 3 platforms with precise permission assignments.",
    "Automated billing and payment processing integrated with multiple payment gateways.",
    "Support ticketing system with SLA management, knowledge base, and CSAT tracking.",
    "Offline capabilities with local Hive caching and conflict resolution systems.",
    "Comprehensive audit logging for security and compliance.",
    "Business intelligence dashboards with detailed SaaS metrics (MRR, churn, CAC, LTV), trends, and cohort analysis."
  ],
  "user_flow_summary": [
    "Client registration and approval: Client registers via portal; admin reviews and approves or rejects.",
    "License lifecycle: Admin creates license; client activates with key; license renews automatically or manually; suspension and reactivation handled with notifications.",
    "Inventory reception: Purchase orders created; partial or full receipt validated; adjusted invoices and batch lot creation.",
    "Cash control daily flow: Open session, register credits and cash movements, record online payments, reconcile estimated and actual cash, resolve variances.",
    "Order management: Clients add products to cart, confirm orders; reservations made; branches confirm and process orders; clients track status and payments.",
    "Sales operation in POS: Search products, add to cart, validate stock, complete sale with inventory consumption by FIFO lot, handle payments including credit, print receipts.",
    "Support ticket lifecycle: Ticket creation, automatic and manual assignments, SLA and status management, customer communication, and satisfaction surveys."
  ],
  "validation_criteria": [
    "All data access strictly respects tenant and branch isolation via row-level security.",
    "Licenses validate usage limits (users, branches, storage, transactions) before allowing operations.",
    "Inventory movements strictly track lots with immutable kardex; FIFO consumption enforced.",
    "Offline sync operations preserve data integrity and require conflict resolution for critical transactions.",
    "Billing processes capture proration correctly for upgrades/downgrades and retry payment attempts with appropriate notifications.",
    "Role-based access restricts data visibility, especially for sensitive price and financial data.",
    "Support tickets follow SLA timelines with notifications and escalation where applicable.",
    "Client orders correctly reserve and consume inventory, and payment statuses accurately reflect in financial systems.",
    "Daily cash reconciliations reconcile system calculations with physical counts enforcing justification and approval for discrepancies.",
    "All financial entries enforce double-entry accounting principles with valid periods and postings."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "NestJS",
      "PostgreSQL",
      "TypeORM",
      "JWT",
      "Passport",
      "pnpm",
      "Turborepo"
    ],
    "features": [
      {
        "name": "User Registration",
        "description": "Register a new user with email, password, tenant, and role",
        "files": [
          "apps/api/src/auth/auth.controller.ts",
          "apps/api/src/auth/auth.service.ts",
          "apps/api/src/auth/dto/auth.dto.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "paths": {
            "/auth/register": {
              "post": {
                "summary": "Register a new user",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "required": [
                          "email",
                          "password",
                          "fullName",
                          "tenantId",
                          "roleId"
                        ],
                        "properties": {
                          "email": {
                            "type": "string",
                            "format": "email"
                          },
                          "password": {
                            "type": "string",
                            "minLength": 8
                          },
                          "fullName": {
                            "type": "string"
                          },
                          "tenantId": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "roleId": {
                            "type": "string",
                            "format": "uuid"
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "201": {
                    "description": "User created successfully"
                  },
                  "409": {
                    "description": "User already exists"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "User Login",
        "description": "Authenticate user and return JWT token",
        "files": [
          "apps/api/src/auth/auth.controller.ts",
          "apps/api/src/auth/auth.service.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "paths": {
            "/auth/login": {
              "post": {
                "summary": "Login user",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "required": [
                          "email",
                          "password"
                        ],
                        "properties": {
                          "email": {
                            "type": "string",
                            "format": "email"
                          },
                          "password": {
                            "type": "string"
                          },
                          "mfaCode": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Login successful, returns accessToken"
                  },
                  "401": {
                    "description": "Invalid credentials"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "User Logout",
        "description": "Logout user and invalidate session",
        "files": [
          "apps/api/src/auth/auth.controller.ts",
          "apps/api/src/auth/auth.service.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "paths": {
            "/auth/logout": {
              "post": {
                "summary": "Logout user",
                "security": [
                  {
                    "bearerAuth": []
                  }
                ],
                "responses": {
                  "200": {
                    "description": "Logout successful"
                  },
                  "401": {
                    "description": "Unauthorized"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "MFA Setup",
        "description": "Setup two-factor authentication for user",
        "files": [
          "apps/api/src/auth/auth.controller.ts",
          "apps/api/src/auth/auth.service.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "paths": {
            "/auth/mfa/setup": {
              "post": {
                "summary": "Setup MFA",
                "security": [
                  {
                    "bearerAuth": []
                  }
                ],
                "responses": {
                  "200": {
                    "description": "Returns QR code URL and secret"
                  },
                  "401": {
                    "description": "Unauthorized"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Check Stock Availability",
        "description": "Check if product variant has sufficient stock at a branch",
        "files": [
          "apps/api/src/inventory/inventory.controller.ts",
          "apps/api/src/inventory/inventory.service.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "paths": {
            "/inventory/check-availability": {
              "post": {
                "summary": "Check stock availability",
                "security": [
                  {
                    "bearerAuth": []
                  }
                ],
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "required": [
                          "variantId",
                          "branchId",
                          "quantity"
                        ],
                        "properties": {
                          "variantId": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "branchId": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "quantity": {
                            "type": "integer",
                            "minimum": 1
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Returns availability status"
                  },
                  "401": {
                    "description": "Unauthorized"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Create Sale",
        "description": "Create a new sale transaction with items",
        "files": [
          "apps/api/src/sales/sales.controller.ts",
          "apps/api/src/sales/sales.service.ts",
          "apps/api/src/sales/dto/create-sale.dto.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "paths": {
            "/sales": {
              "post": {
                "summary": "Create a sale",
                "security": [
                  {
                    "bearerAuth": []
                  }
                ],
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "required": [
                          "branchId",
                          "cashierId",
                          "paymentMethod",
                          "items"
                        ],
                        "properties": {
                          "branchId": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "cashierId": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "customerId": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "paymentMethod": {
                            "type": "string",
                            "enum": [
                              "cash",
                              "card",
                              "transfer",
                              "mixed"
                            ]
                          },
                          "items": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "required": [
                                "variantId",
                                "quantity",
                                "unitPrice"
                              ],
                              "properties": {
                                "variantId": {
                                  "type": "string",
                                  "format": "uuid"
                                },
                                "quantity": {
                                  "type": "integer",
                                  "minimum": 1
                                },
                                "unitPrice": {
                                  "type": "number"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "201": {
                    "description": "Sale created successfully"
                  },
                  "400": {
                    "description": "Validation error or insufficient stock"
                  },
                  "401": {
                    "description": "Unauthorized"
                  }
                }
              }
            }
          }
        }
      }
    ]
  }
}
