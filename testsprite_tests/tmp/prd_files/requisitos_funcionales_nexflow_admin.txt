# NEXFLOW ADMIN - PLATAFORMA DE ADMINISTRACI√ìN
# REQUISITOS FUNCIONALES Y ARQUITECTURA DE SERVICIOS
# DOCUMENTO DE ESPECIFICACI√ìN
# Versi√≥n: 1.0
# Fecha: Enero 2026

================================================================================
1. VISI√ìN GENERAL DE LA PLATAFORMA ADMIN
================================================================================

1.1 Prop√≥sito
NexFlow Admin es la plataforma de control centralizado que permite al equipo de DevCorp gestionar todo el ecosistema SaaS:
- Clientes empresariales (tenants)
- Licencias y suscripciones
- Facturaci√≥n y cobros
- Soporte t√©cnico
- M√©tricas de negocio
- Configuraci√≥n global del sistema

1.2 Usuarios de la Plataforma

ROLES INTERNOS DEVCORP:

Super Admin:
- Acceso total sin restricciones
- Configuraci√≥n global del sistema
- Gesti√≥n de equipo DevCorp

Sales Manager:
- Gesti√≥n de leads y oportunidades
- Creaci√≥n de licencias trial/comercial
- Dashboard de ventas
- NO puede modificar facturaci√≥n

Support Agent:
- Gesti√≥n de tickets de soporte
- Chat con clientes
- Base de conocimientos
- NO puede modificar licencias

Finance Manager:
- Gesti√≥n de facturaci√≥n
- Cobros y pagos
- Reportes financieros
- NO puede suspender licencias

Product Manager:
- M√©tricas de uso del producto
- An√°lisis de features
- Feedback de clientes
- Solo lectura en otros m√≥dulos

DevOps Engineer:
- Monitoreo de infraestructura
- Logs y debugging
- Deploy y releases
- Configuraci√≥n de servidores

1.3 Acceso a la Plataforma
URL: admin.nexflow.app

Requisitos de Acceso:
- Email corporativo @devcorp.com
- Contrase√±a robusta
- Autenticaci√≥n 2FA obligatoria
- Sesi√≥n expira tras 8 horas de inactividad
- IP whitelist (opcional para producci√≥n)

================================================================================
2. ARQUITECTURA DE SERVICIOS
================================================================================

2.1 Servicios Core de la Plataforma Admin

TENANT SERVICE:
- Gesti√≥n de clientes empresariales
- CRUD de tenants
- Onboarding workflow
- Configuraci√≥n por tenant

LICENSE SERVICE:
- Generaci√≥n de licencias
- Validaci√≥n de licencias
- Renovaci√≥n autom√°tica
- Suspensi√≥n/Activaci√≥n
- Control de l√≠mites

BILLING SERVICE:
- Facturaci√≥n recurrente
- Procesamiento de pagos
- C√°lculos prorrateados
- Gesti√≥n de m√©todos de pago
- Integraci√≥n con pasarelas

SUBSCRIPTION SERVICE:
- Gesti√≥n de suscripciones
- Cambios de plan (upgrade/downgrade)
- C√°lculo de addons
- Ciclos de facturaci√≥n

SUPPORT SERVICE:
- Sistema de tickets
- Asignaci√≥n autom√°tica
- SLA tracking
- Base de conocimientos

ANALYTICS SERVICE:
- M√©tricas de negocio (MRR, churn, etc.)
- An√°lisis de uso
- Dashboards ejecutivos
- Reportes personalizados

NOTIFICATION SERVICE:
- Email transaccional
- Notificaciones internas
- Alertas autom√°ticas
- Templates personalizables

DISTRIBUTION SERVICE:
- Gesti√≥n de releases de apps
- Upload de binarios (APK, EXE, DMG)
- Versionado
- Estad√≠sticas de descargas

AUDIT SERVICE:
- Registro de todas las acciones
- Logs centralizados
- Compliance y seguridad

2.2 Comunicaci√≥n entre Servicios
Patr√≥n: Event-Driven Architecture + API REST

Eventos del Sistema:

| Evento | Published by | Suscriptores |
|--------|--------------|--------------|
| tenant_created | Tenant Service | License, Billing, Analytics |
| license_activated | License Service | Billing, Notification, Analytics |
| license_expired | License Service | Tenant, Notification |
| payment_received | Billing Service | License, Notification, Analytics |
| payment_failed | Billing Service | License, Notification, Support |
| ticket_created | Support Service | Notification, Analytics |
| subscription_upgraded | Subscription Service | License, Billing, Notification |

================================================================================
3. M√ìDULO 1: GESTI√ìN DE CLIENTES EMPRESARIALES
================================================================================

3.1.1 Dashboard de Clientes

RF-ADMIN-001: Vista General de Clientes
- Mostrar lista completa de clientes (tenants)
- Vista de tarjetas o tabla
- Informaci√≥n visible por cliente:
  - Logo y nombre comercial
  - Plan actual
  - Estado de licencia (activo, trial, suspendido, cancelado)
  - Fecha de registro
  - D√≠as como cliente
  - MRR (ingreso mensual recurrente de ese cliente)
  - √öltima actividad
  - N√∫mero de usuarios activos
  - N√∫mero de sucursales
  - Uso de almacenamiento (% del l√≠mite)
- Indicadores de salud del cliente:
  - üü¢ Saludable (usa el sistema, paga a tiempo)
  - üü° En riesgo (poco uso, pago retrasado)
  - üî¥ Cr√≠tico (no paga, no usa, pr√≥ximo a cancelar)

RF-ADMIN-002: Filtros y B√∫squeda
- Buscar por:
  - Nombre comercial
  - NIT/RIF
  - Email de contacto
  - Tel√©fono
  - ID de tenant
- Filtrar por:
  - Estado (activo, trial, suspendido, cancelado)
  - Plan (trial, basic, pro, enterprise)
  - Fecha de registro (rangos)
  - Riesgo de churn (bajo, medio, alto)
  - Regi√≥n/ciudad
  - Facturaci√≥n atrasada (s√≠/no)
  - Uso de sistema (alto, medio, bajo)
- Ordenar por:
  - Fecha de registro (m√°s reciente/antiguo)
  - MRR (mayor a menor)
  - Nombre (A-Z)
  - Estado de licencia

RF-ADMIN-003: Registro de Nuevo Cliente
- Formulario de alta con campos:
  - Datos de la empresa:
    - Nombre comercial (obligatorio)
    - Raz√≥n social
    - NIT/RIF (obligatorio)
    - Sector/industria (selecci√≥n: L√°cteos, C√°rnicos, Av√≠cola, Mixto, Otro)
    - Tama√±o empresa (micro, peque√±a, mediana, grande)
    - Pa√≠s (Colombia por defecto)
    - Departamento/Estado
    - Ciudad
    - Direcci√≥n f√≠sica
    - Sitio web (opcional)
  - Contacto principal:
    - Nombre completo (obligatorio)
    - Cargo
    - Email corporativo (obligatorio)
    - Tel√©fono (obligatorio)
    - WhatsApp (obligatorio)
  - Informaci√≥n comercial:
    - Origen (c√≥mo nos conoci√≥): Web, referido, llamada, evento, otro
    - Referido por (si aplica)
    - Observaciones/notas internas
- Validaciones:
  - NIT √∫nico en el sistema
  - Email √∫nico
  - Formato de email v√°lido
  - Tel√©fono formato v√°lido
- Al crear cliente:
  - Asignar ID √∫nico (tenant_id)
  - Generar slug √∫nico (para URL: queseria-dg)
  - Establecer estado inicial: "Lead"
  - Asignar al usuario de ventas que lo cre√≥
  - Registrar timestamp de creaci√≥n

RF-ADMIN-004: Perfil Completo del Cliente
Vista unificada con toda la informaci√≥n del cliente en pesta√±as:

Pesta√±a: Informaci√≥n General
- Datos de la empresa (editable)
- Datos del contacto (editable)
- Historial de cambios de datos
- Notas internas (agregar, editar, eliminar con timestamp y autor)

Pesta√±a: Licencias
- Licencias activas del cliente
- Historial de licencias (anteriores, renovaciones)
- Acciones r√°pidas:
  - Crear nueva licencia
  - Renovar licencia
  - Suspender/Reactivar
  - Cambiar plan

Pesta√±a: Suscripciones y Facturaci√≥n
- Suscripci√≥n actual
- Plan contratado
- Ciclo de facturaci√≥n (mensual/anual)
- M√©todo de pago registrado
- Pr√≥xima fecha de facturaci√≥n
- Historial de facturas
- Historial de pagos
- Cuentas por cobrar

Pesta√±a: Uso del Sistema
- Estad√≠sticas de uso:
  - Usuarios activos (total y por sucursal)
  - Sucursales creadas
  - Almacenamiento usado
  - Transacciones del mes
  - M√≥dulos m√°s usados
  - √öltima actividad por usuario
- Gr√°ficos de uso en el tiempo

Pesta√±a: Soporte
- Tickets de soporte del cliente
- Estado de tickets abiertos
- Tiempo promedio de resoluci√≥n
- Calificaci√≥n de satisfacci√≥n promedio
- Historial de interacciones

Pesta√±a: Comunicaciones
- Historial de emails enviados
- Llamadas registradas
- Reuniones agendadas
- Demos realizadas
- Notas de seguimiento
- Pr√≥ximas acciones programadas

Pesta√±a: M√©tricas de Cliente
- D√≠as como cliente
- Lifetime Value (LTV) actual
- Lifetime Value proyectado
- Churn risk score (0-100)
- NPS del cliente
- Health score (salud del cliente)
- Probabilidad de upgrade
- Probabilidad de churn

RF-ADMIN-005: Edici√≥n de Cliente
- Todos los campos editables excepto:
  - tenant_id (inmutable)
  - slug (solo cambiable con confirmaci√≥n)
  - Fechas de creaci√≥n
- Registrar auditor√≠a de cambios:
  - Qu√© se cambi√≥
  - Valor anterior ‚Üí Valor nuevo
  - Qui√©n lo cambi√≥
  - Cu√°ndo se cambi√≥

RF-ADMIN-006: Cambio de Estado de Cliente
Estados del ciclo de vida:
- Lead: Prospecto, a√∫n no usa el sistema
- Trial: En per√≠odo de prueba
- Active: Cliente activo pagando
- Churned: Cancel√≥ suscripci√≥n
- Suspended: Suspendido por falta de pago
- Reactivated: Fue suspendido y se reactiv√≥

Cambios de estado:
- Lead ‚Üí Trial (al crear licencia trial)
- Trial ‚Üí Active (al contratar plan comercial)
- Active ‚Üí Suspended (por falta de pago)
- Suspended ‚Üí Active (al pagar deuda)
- Active ‚Üí Churned (al cancelar)
- Churned ‚Üí Reactivated (si vuelve)

Al cambiar estado:
- Registrar motivo (obligatorio)
- Notificar al equipo relevante
- Actualizar m√©tricas
- Ejecutar automatizaciones seg√∫n estado

RF-ADMIN-007: Segmentaci√≥n de Clientes
- Etiquetar clientes con tags:
  - Segmento de mercado (ejemplo: "Queser√≠as grandes")
  - Regi√≥n geogr√°fica (ejemplo: "Costa Atl√°ntica")
  - Comportamiento (ejemplo: "Power user", "Riesgo churn")
  - Potencial (ejemplo: "Upsell candidate")
- Tags visuales con colores
- Filtrar clientes por tags
- Crear segmentos guardados (vistas personalizadas)

RF-ADMIN-008: Exportaci√≥n de Datos de Clientes
- Exportar listado de clientes a:
  - Excel (.xlsx)
  - CSV
  - PDF (formato presentaci√≥n)
- Seleccionar campos a exportar
- Aplicar filtros antes de exportar
- Programar exportes autom√°ticos (opcional)

RF-ADMIN-009: Historial de Interacciones
Registrar todas las interacciones con el cliente:

Llamadas:
- Fecha y hora
- Duraci√≥n
- Responsable (qui√©n llam√≥)
- Resumen de la conversaci√≥n
- Resultado (contest√≥, no contesWebFetch
- Pr√≥xima acci√≥n

Emails:
- Registro autom√°tico de emails enviados
- Templates usados
- Apertura (si tracking activo)
- Clics en enlaces

Reuniones:
- Fecha y hora programada
- Participantes
- Tipo (demo, onboarding, soporte, comercial)
- Notas de la reuni√≥n
- Acuerdos/compromisos

Demos:
- Fecha de demo
- Productos/m√≥dulos demostrados
- Nivel de inter√©s (bajo, medio, alto)
- Objeciones mencionadas
- Pr√≥ximos pasos

Otros:
- Webinars asistidos
- Eventos compartidos
- Feedback recibido

RF-ADMIN-010: Acciones R√°pidas sobre Cliente
Desde cualquier vista de cliente, acciones de un clic:
- üìû Llamar (integraci√≥n con VoIP)
- ‚úâÔ∏è Enviar email (abrir composer)
- üí¨ Abrir chat (si est√° online)
- üé´ Crear ticket de soporte
- üìä Ver m√©tricas detalladas
- üîí Suspender acceso
- ‚úÖ Reactivar acceso
- üìÑ Generar reporte de cliente
- üóëÔ∏è Eliminar cliente (con confirmaci√≥n m√∫ltiple)

================================================================================
M√ìDULO 2: GESTI√ìN DE LICENCIAS
================================================================================

3.2.1 Dashboard de Licencias

RF-ADMIN-011: Vista General de Licencias
M√©tricas en cards principales:
- Total licencias activas
- Licencias en trial (con conversi√≥n goal)
- Licencias por vencer (pr√≥ximos 15 d√≠as)
- Licencias vencidas (√∫ltimos 7 d√≠as)
- Licencias suspendidas
- Nuevas licencias este mes

Gr√°ficos:
- Evoluci√≥n de licencias en el tiempo (l√≠nea)
- Distribuci√≥n por plan (torta)
- Conversi√≥n trial ‚Üí comercial (embudo)
- Tasa de renovaci√≥n mensual (%)

RF-ADMIN-012: Listado de Licencias
Tabla con columnas:
- ID de licencia
- Cliente (nombre + logo)
- Plan
- Estado (badge con color)
- Fecha de inicio
- Fecha de expiraci√≥n
- D√≠as restantes
- Auto-renovaci√≥n (s√≠/no)
- Acciones

Filtros:
- Por estado
- Por plan
- Por cliente
- Por fecha de expiraci√≥n
- Por auto-renovaci√≥n
- Vencen en X d√≠as

Acciones masivas:
- Renovar seleccionadas
- Enviar recordatorio
- Exportar selecci√≥n

RF-ADMIN-013: Creaci√≥n de Licencia
Wizard de 4 pasos:

Paso 1: Seleccionar Cliente
- Buscar y seleccionar cliente existente
- O crear cliente nuevo (abre modal de RF-ADMIN-003)
- Mostrar info del cliente seleccionado

Paso 2: Configurar Plan
- Seleccionar tipo de plan:
  - Trial (30 d√≠as gratis)
  - Basic
  - Pro
  - Enterprise
  - Custom (configuraci√≥n manual)
- Si es trial:
  - Duraci√≥n en d√≠as (default 30, editable)
  - ¬øRequiere tarjeta de cr√©dito? (s√≠/no)
  - ¬øConvertir autom√°ticamente a plan pagado al terminar? (s√≠/no + plan destino)
- Si es comercial:
  - Seleccionar plan de cat√°logo
  - O configurar plan custom:
    - Nombre del plan custom
    - Precio mensual/anual
    - L√≠mites personalizados

Paso 3: Configurar L√≠mites
Mostrar l√≠mites del plan seleccionado (editables en custom):
- Sucursales: N√∫mero m√°ximo permitido
- Usuarios: N√∫mero m√°ximo permitido
- Almacenamiento: GB permitidos
- Transacciones/mes: L√≠mite mensual
- M√≥dulos habilitados: Selecci√≥n m√∫ltiple de 32 m√≥dulos
- Caracter√≠sticas especiales:
  - Soporte prioritario (s√≠/no)
  - API access (s√≠/no + rate limit)
  - Whitelabel (s√≠/no)
  - Ambiente staging (s√≠/no)
  - Onboarding dedicado (s√≠/no)

Paso 4: Configurar Fechas y Activaci√≥n
- Fecha de inicio: Hoy o fecha futura
- Duraci√≥n:
  - Si trial: D√≠as (default 30)
  - Si comercial: Mensual o Anual
- Fecha de expiraci√≥n: Calculada autom√°ticamente
- M√©todo de activaci√≥n:
  - Inmediata (activa al crear)
  - Por clave (cliente debe activar con c√≥digo)
  - Programada (se activa en fecha espec√≠fica)
- Notas internas: Observaciones para el equipo

Al confirmar:
- Sistema genera:
  - ID √∫nico de licencia
  - Clave de activaci√≥n (si aplica)
  - Token de API
- Crea registro en BD
- Env√≠a email autom√°tico al cliente con:
  - Clave de activaci√≥n
  - Credenciales temporales (usuario admin)
  - Gu√≠a de primeros pasos
  - Enlace a onboarding
- Notifica al equipo de ventas
- Registra evento en analytics

RF-ADMIN-014: Detalle de Licencia
Vista completa con toda la informaci√≥n:

Secci√≥n: Informaci√≥n General
- ID de licencia
- Cliente asociado (clic para ver perfil)
- Plan contratado
- Estado actual (con timeline de cambios de estado)
- Fecha de creaci√≥n
- Creada por (usuario DevCorp)
- Clave de activaci√≥n (con bot√≥n copiar)
- Token de API (con bot√≥n copiar + regenerar)

Secci√≥n: Fechas y Duraci√≥n
- Fecha de inicio
- Fecha de expiraci√≥n
- D√≠as transcurridos
- D√≠as restantes
- Contador visual de tiempo (barra de progreso)
- Auto-renovaci√≥n (toggle on/off)
- Pr√≥xima fecha de renovaci√≥n

Secci√≥n: L√≠mites y Uso Actual
Tabla comparativa:
| Recurso | L√≠mite | Uso Actual | % Usado | Estado |
|---------|--------|------------|---------|--------|
| Sucursales | 5 | 3 | 60% | üü¢ OK |
| Usuarios | 20 | 18 | 90% | üü° Cerca del l√≠mite |
| Almacenamiento | 200GB | 150GB | 75% | üü¢ OK |
| Transacciones/mes | 10,000 | 8,500 | 85% | üü° Alto uso |

Alertas:
- Si uso > 80%: Sugerir upgrade
- Si uso > 95%: Alerta cr√≠tica
- Si excede l√≠mite: Bloqueo (seg√∫n configuraci√≥n)

Secci√≥n: M√≥dulos Habilitados
- Lista visual (grid) de m√≥dulos
- ‚úÖ Habilitados (verdes)
- ‚ùå Deshabilitados (grises)
- Bot√≥n "Editar m√≥dulos" (abre modal para habilitar/deshabilitar)

Secci√≥n: Historial de la Licencia
Timeline con eventos:
- Creaci√≥n
- Activaci√≥n
- Renovaciones
- Cambios de plan
- Suspensiones/reactivaciones
- Modificaciones de l√≠mites
- Cambios de m√≥dulos
- Cada evento con:
  - Fecha y hora
  - Usuario responsable
  - Detalles del cambio

Secci√≥n: Facturaci√≥n Asociada
- Facturas generadas para esta licencia
- Estado de pago de cada factura
- Pr√≥xima factura programada
- Monto de pr√≥xima factura

RF-ADMIN-015: Activaci√≥n Manual de Licencia
Si licencia est√° en estado "Pendiente":
- Bot√≥n "Activar Ahora"
- Confirmaci√≥n requerida
- Al activar:
  - Estado cambia a "Activa"
  - Inicia conteo de tiempo
  - Desbloquea acceso al cliente
  - Env√≠a notificaci√≥n al cliente
  - Registra evento

RF-ADMIN-016: Renovaci√≥n de Licencia
Desde detalle de licencia, bot√≥n "Renovar":
- Modal con opciones:
  - Tipo de renovaci√≥n:
    - Mensual (+1 mes)
    - Anual (+12 meses)
    - Custom (especificar duraci√≥n)
  - Cambio de plan (opcional):
    - Mantener plan actual
    - Cambiar a otro plan (con c√°lculo prorrateado)
  - Notas de renovaci√≥n
- Mostrar c√°lculo:
  - Fecha de expiraci√≥n actual
  - Nueva fecha de expiraci√≥n
  - Monto a cobrar
  - M√©todo de pago (si existe)
- Opciones de cobro:
  - Cobrar ahora (procesar pago inmediatamente)
  - Programar cobro (en fecha de expiraci√≥n)
  - Renovar sin cobrar (cortes√≠a)
- Al confirmar:
  - Extiende fecha de expiraci√≥n
  - Genera factura (si aplica)
  - Procesa pago (si se eligi√≥ cobrar ahora)
  - Notifica al cliente
  - Registra renovaci√≥n en historial

RF-ADMIN-017: Suspensi√≥n de Licencia
Desde detalle de licencia, bot√≥n "Suspender":
- Modal con motivo obligatorio:
  - Falta de pago
  - Violaci√≥n de t√©rminos de servicio
  - Uso indebido
  - Solicitud del cliente
  - Otro (especificar)
- Opciones:
  - Efecto inmediato o programado (fecha)
  - Periodo de gracia: D√≠as antes de bloqueo total (0-30 d√≠as)
  - Notificar al cliente: S√≠/No (con template de email editable)
- Al confirmar:
  - Estado cambia a "Suspended"
  - Bloquea acceso del cliente a NexFlow Business
  - Cliente ve mensaje: "Tu suscripci√≥n ha sido suspendida. Contacta a soporte."
  - Datos del cliente NO se eliminan (preservados)
  - Env√≠a email de notificaci√≥n
  - Crea ticket de soporte autom√°tico (si aplica)
  - Registra en historial

RF-ADMIN-018: Reactivaci√≥n de Licencia
Si licencia est√° suspendida:
- Bot√≥n "Reactivar"
- Modal con:
  - Revisar motivo de suspensi√≥n
  - ¬øMotivo resuelto? (obligatorio describir)
  - ¬øExtender per√≠odo como compensaci√≥n? (d√≠as extra)
  - Notas internas
- Al confirmar:
  - Estado cambia a "Activa"
  - Restablece acceso del cliente
  - Extiende per√≠odo si aplica
  - Notifica al cliente
  - Cierra ticket de soporte asociado
  - Registra en historial

RF-ADMIN-019: Cancelaci√≥n de Licencia
Desde detalle de licencia, bot√≥n "Cancelar":
- Modal de confirmaci√≥n con advertencias:
  - ‚ö†Ô∏è "Esta acci√≥n no se puede deshacer f√°cilmente"
  - ‚ö†Ô∏è "El cliente perder√° acceso al sistema"
  - ‚ö†Ô∏è "Los datos se retendr√°n por X d√≠as"
- Motivo obligatorio:
  - Cliente solicit√≥ cancelaci√≥n
  - Falta de pago persistente
  - Migraci√≥n a competencia
  - Cierre del negocio del cliente
  - Otro (especificar)
- Opciones:
  - Momento de cancelaci√≥n:
    - Inmediata (ahora)
    - Al final del per√≠odo pagado
    - Fecha espec√≠fica
  - Retenci√≥n de datos:
    - 30 d√≠as
    - 60 d√≠as
    - 90 d√≠as
    - Indefinido (hasta que cliente solicite eliminaci√≥n)
  - Reembolso: S√≠/No + monto
  - Encuesta de salida: Enviar al cliente (para feedback)
- Al confirmar:
  - Estado cambia a "Cancelled"
  - Deshabilita auto-renovaci√≥n
  - Bloquea acceso (seg√∫n timing elegido)
  - Procesa reembolso (si aplica)
  - Env√≠a email de despedida + encuesta
  - Ofrece exportaci√≥n de datos
  - Registra en historial
  - Actualiza m√©tricas de churn

RF-ADMIN-020: Upgrade/Downgrade de Plan
Desde detalle de licencia, bot√≥n "Cambiar Plan":
- Modal con selecci√≥n de nuevo plan
- Comparativa visual: Plan actual vs Plan nuevo
- Diferencias en l√≠mites y caracter√≠sticas
- C√°lculo prorrateado autom√°tico:
  - Si es upgrade (plan m√°s caro):
    - D√≠as restantes del per√≠odo actual
    - Costo del nuevo plan (proporcional a d√≠as restantes)
    - Cr√©dito del plan actual (proporcional)
    - Diferencia a cobrar = Nuevo - Cr√©dito
    - Mostrar: "Se cobrar√° $X ahora y $Y en la pr√≥xima renovaci√≥n"
  - Si es downgrade (plan m√°s barato):
    - Calcular cr√©dito proporcional
    - Aplicar a pr√≥xima factura
    - Mostrar: "Tu pr√≥xima factura ser√° $X (con cr√©dito de $Y aplicado)"
- Validaci√≥n de l√≠mites:
  - Si downgrade reduce l√≠mites:
    - Verificar uso actual del cliente
    - Si uso excede nuevo l√≠mite:
      - ‚ö†Ô∏è Alerta: "Cliente actualmente usa X usuarios, nuevo plan permite Y"
      - Opciones:
        - Bloquear cambio hasta que cliente reduzca uso
        - Permitir cambio con periodo de gracia (N d√≠as para ajustar)
        - Forzar cambio (bloquear√° funcionalidad excedida)
- Fecha de aplicaci√≥n:
  - Inmediata
  - Al finalizar per√≠odo actual
  - Fecha espec√≠fica
- Al confirmar:
  - Actualiza plan en licencia
  - Ajusta l√≠mites
  - Habilita/deshabilita m√≥dulos seg√∫n nuevo plan
  - Genera factura/nota de cr√©dito (si aplica)
  - Procesa cobro/reembolso
  - Notifica al cliente
  - Actualiza dashboard del cliente (ve nuevo plan)
  - Registra en historial

RF-ADMIN-021: Gesti√≥n de Claves de Activaci√≥n
- Regenerar clave de activaci√≥n:
  - Genera nueva clave
  - Invalida clave anterior
  - Usa caso: cliente perdi√≥ la clave
- Regenerar token de API:
  - Genera nuevo token
  - Invalida token anterior
  - Requiere confirmaci√≥n (puede romper integraciones)
- Copiar credenciales:
  - Bot√≥n "Copiar todo" (clave + token + usuario)
  - Para enviar manual al cliente

RF-ADMIN-022: Control de L√≠mites en Tiempo Real
Sistema monitorea uso del cliente 24/7:

Sucursales:
- Si cliente intenta crear sucursal N+1 cuando l√≠mite es N:
  - Sistema bloquea creaci√≥n en NexFlow Business
  - Muestra mensaje: "Has alcanzado el l√≠mite de sucursales de tu plan. Upgrade para crear m√°s."
  - Bot√≥n en mensaje lleva a portal del cliente ‚Üí Upgrade
  - En plataforma admin: Alerta visual en dashboard

Usuarios:
- Mismo comportamiento que sucursales

Almacenamiento:
- Alertas escalonadas:
  - 80% usado: Notificaci√≥n informativa al cliente
  - 90% usado: Alerta al cliente + admin
  - 95% usado: Alerta cr√≠tica + sugerencia de upgrade
  - 100% usado: Bloqueo de subida de archivos (mantiene funcionalidad)
- Cliente puede limpiar archivos o hacer upgrade

Transacciones mensuales:
- Contador mensual en dashboard del cliente
- Alertas: 75%, 90%, 100%
- Si excede: NO bloquear (permitir operar), pero:
  - Notificar exceso al cliente
  - Cobro extra por transacciones adicionales (seg√∫n pol√≠tica)
  - O sugerir upgrade a plan superior

RF-ADMIN-023: Alertas y Notificaciones de Licencias
Sistema genera alertas autom√°ticas para admin:

30 d√≠as antes de expiraci√≥n:
- Email a sales owner del cliente
- Recordatorio de contactar para renovaci√≥n

15 d√≠as antes de expiraci√≥n:
- Email a cliente (autom√°tico)
- Email a sales + support

7 d√≠as antes de expiraci√≥n:
- Email a cliente (m√°s urgente)
- Notificaci√≥n in-app para admin
- SMS al contacto principal (opcional)

3 d√≠as antes de expiraci√≥n:
- Email cr√≠tico a cliente
- Llamada telef√≥nica programada (task para sales)

D√≠a de expiraci√≥n:
- Si auto-renovaci√≥n activa: Procesar pago
- Si no: Suspender acceso + enviar √∫ltimo aviso

Licencia suspendida:
- Task para support: "Verificar motivo y contactar"

Pago fallido:
- Notificaci√≥n inmediata a finance + sales
- Email autom√°tico a cliente

RF-ADMIN-024: Exportaci√≥n de Datos de Licencias
- Exportar todas las licencias o selecci√≥n
- Formatos: Excel, CSV, PDF
- Campos configurables
- Incluir uso actual (opcional)
- Programar reportes autom√°ticos

================================================================================
M√ìDULO 3: PLANES Y SUSCRIPCIONES
================================================================================

3.3.1 Gesti√≥n de Planes

RF-ADMIN-025: Cat√°logo de Planes
Vista de todos los planes disponibles:
- Planes activos (visibles para clientes)
- Planes archivados (ya no se venden pero existen suscripciones)
- Planes en borrador (a√∫n no publicados)

Para cada plan mostrar:
- Nombre
- Slug
- Precio mensual/anual
- N√∫mero de suscripciones activas
- Estado (activo, archivado, borrador)
- Visibilidad (p√∫blico/privado)
- Acciones (editar, archivar, duplicar)

RF-ADMIN-026: Creaci√≥n de Plan
Formulario completo:

Secci√≥n: Informaci√≥n B√°sica
- Nombre del plan (ej: "Pro")
- Slug (generado autom√°tico, editable): "pro"
- Descripci√≥n corta (1 l√≠nea)
- Descripci√≥n larga (markdown)
- Orden de visualizaci√≥n (n√∫mero, para sorting en p√°gina de pricing)
- Badge/etiqueta (ej: "M√°s Popular", "Mejor Valor")

Secci√≥n: Precios
- Precio mensual (COP)
- Precio anual (COP)
  - Descuento anual (%) - calculado autom√°ticamente
- Precio de setup/onboarding (opcional, one-time)
- Moneda (COP default, soportar USD, EUR futuro)
- ¬øMostrar precio en p√°gina p√∫blica? (s√≠/no - si no, mostrar "Contactar")

Secci√≥n: L√≠mites
- Sucursales m√°ximas (n√∫mero o "ilimitado")
- Usuarios m√°ximos (n√∫mero o "ilimitado")
- Almacenamiento (GB)
- Transacciones mensuales (n√∫mero o "ilimitado")
- Soporte incluido:
  - Email (tiempo de respuesta en horas)
  - Chat (s√≠/no)
  - Tel√©fono (s√≠/no)
  - Dedicado (s√≠/no)

Secci√≥n: M√≥dulos Incluidos
- Lista de los 32 m√≥dulos con checkboxes
- Seleccionar todos / ninguno
- Presets: "B√°sicos", "Est√°ndar", "Completo"

Secci√≥n: Caracter√≠sticas Destacadas
Lista de features para mostrar en pricing page:
- Ejemplo: "Inventario con trazabilidad por lotes"
- Ejemplo: "Contabilidad automatizada"
- Agregar/quitar features
- Ordenar (drag & drop)
- Marcar como "destacado" (con √≠cono especial)

Secci√≥n: Restricciones
- ¬øRequiere aprobaci√≥n para contratar? (s√≠/no)
- ¬øSolo para ciertos pa√≠ses? (selecci√≥n m√∫ltiple)
- ¬øSolo para ciertos sectores? (selecci√≥n m√∫ltiple)
- Cantidad m√≠nima de usuarios (para planes enterprise)
- Contrato m√≠nimo (meses)

Secci√≥n: Trial
- ¬øOfrecer trial? (s√≠/no)
- Duraci√≥n del trial (d√≠as)
- ¬øRequiere tarjeta de cr√©dito para trial? (s√≠/no)
- ¬øConversi√≥n autom√°tica a pagado? (s√≠/no)

Secci√≥n: Visibilidad
- P√∫blico (visible en p√°gina de pricing)
- Privado (solo asignable manualmente por admin)
- Estado: Activo / Inactivo / Borrador

Al guardar:
- Validar todos los campos
- Generar slug √∫nico
- Crear plan en BD
- No afecta suscripciones existentes (solo nuevas)

RF-ADMIN-027: Edici√≥n de Plan
- Modificar cualquier campo del plan
- Cambios NO afectan suscripciones activas (mantienen plan original)
- Opci√≥n: "Aplicar cambios a suscripciones existentes"
  - Mostrar cu√°ntas suscripciones se afectar√≠an
  - Confirmaci√≥n obligatoria
  - Notificar a clientes afectados (opcional)
- Historial de cambios del plan (versionado)

RF-ADMIN-028: Archivar Plan
- Planes archivados no aparecen en cat√°logo p√∫blico
- Suscripciones existentes siguen funcionando normalmente
- No se pueden crear nuevas suscripciones con plan archivado
- Se puede "desarchivar" (volver a activar)
- Mostrar raz√≥n de archivo

RF-ADMIN-029: Duplicar Plan
- Crea copia exacta del plan
- Nuevo slug autom√°tico (ej: "pro-copy")
- √ötil para crear variaciones r√°pidamente

RF-ADMIN-030: P√°gina de Pricing P√∫blica
Configuraci√≥n de la p√°gina p√∫blica de precios:

Layout:
- Vista de tarjetas (grid)
- Vista de tabla comparativa
- Ambos (tarjetas arriba, tabla abajo)

Planes a mostrar:
- Seleccionar qu√© planes p√∫blicos mostrar
- Orden de visualizaci√≥n
- Cu√°l marcar como "Recomendado"

Calculadora de precio:
- Mostrar/ocultar calculadora interactiva
- "¬øCu√°ntos usuarios necesitas?"
- "¬øCu√°ntas sucursales?"
- Calcular precio estimado

Comparativa de caracter√≠sticas:
- Tabla con todas las features
- Checkmarks por plan
- Scroll horizontal en m√≥vil

Toggle Mensual/Anual:
- Mostrar ahorro al elegir anual
- Animaci√≥n de cambio de precio

FAQs:
- Preguntas frecuentes sobre precios
- Editables desde admin

Testimonios:
- Incluir testimonios de clientes
- Con foto, nombre, empresa

Call to Actions:
- Botones personalizables por plan
- "Comenzar Trial", "Contratar", "Contactar Ventas"

Pr√©visualizaci√≥n en vivo de cambios

3.3.2 Gesti√≥n de Addons

RF-ADMIN-031: Cat√°logo de Addons
Lista de complementos disponibles:
- Nombre del addon
- Tipo (m√≥dulo, l√≠mite, feature)
- Precio mensual
- Compatible con qu√© planes
- N√∫mero de clientes que lo tienen activo
- Estado (activo/inactivo)

RF-ADMIN-032: Creaci√≥n de Addon
Formulario:

Informaci√≥n b√°sica:
- Nombre (ej: "Almacenamiento Extra")
- Slug: "storage-extra"
- Descripci√≥n
- √çcono/imagen

Tipo de addon:
- M√≥dulo adicional (habilita m√≥dulo X)
- Incremento de l√≠mite (+ usuarios, + storage, + sucursales)
- Feature especial (whitelabel, soporte 24/7, etc.)

Precio:
- Mensual
- Anual (con descuento opcional)

Valor/Cantidad:
- Si es l√≠mite: Cantidad que agrega (ej: +50GB, +5 usuarios)
- Si es m√≥dulo: M√≥dulo que habilita

Compatibilidad:
- Todos los planes
- Solo ciertos planes (selecci√≥n)

Configuraci√≥n:
- ¬øRequiere aprobaci√≥n? (s√≠/no)
- ¬øCantidad variable? (cliente puede comprar m√∫ltiples unidades)

Estado: Activo/Inactivo

RF-ADMIN-033: Asignaci√≥n de Addon a Cliente
Desde perfil de cliente o licencia:
- Bot√≥n "Agregar Addon"
- Seleccionar addon de cat√°logo
- Si es variable, especificar cantidad
- Calcular precio total
- Establecer fecha de inicio (hoy o pr√≥xima factura)
- Confirmar
- Al confirmar:
  - Addon se activa inmediatamente
  - Aumenta l√≠mites (si aplica)
  - Habilita m√≥dulo (si aplica)
  - Se incluye en pr√≥xima factura
  - Notifica al cliente

RF-ADMIN-034: Remover Addon de Cliente
- Desde lista de addons activos del cliente
- Seleccionar addon a remover
- Opciones:
  - Remover ahora (inmediato)
  - Remover al final del per√≠odo de facturaci√≥n
- Calcular cr√©dito (si aplica)
- Confirmar
- Al confirmar:
  - Deshabilita addon
  - Reduce l√≠mites (si aplica)
  - Cr√©dito en pr√≥xima factura o no cobrar m√°s
  - Notifica al cliente

3.3.3 Gesti√≥n de Suscripciones

RF-ADMIN-035: Dashboard de Suscripciones
M√©tricas clave:
- Total suscripciones activas
- MRR (Monthly Recurring Revenue) total
- ARR (Annual Recurring Revenue) total
- Nuevas suscripciones este mes
- Suscripciones canceladas este mes
- Churn rate (%)
- Distribuci√≥n por plan (gr√°fico)
- Distribuci√≥n por ciclo (mensual vs anual)

RF-ADMIN-036: Listado de Suscripciones
Tabla con todas las suscripciones:
- ID suscripci√≥n
- Cliente
- Plan
- Ciclo (mensual/anual)
- Estado
- Fecha inicio per√≠odo actual
- Fecha fin per√≠odo actual
- MRR (ingreso mensual de esa suscripci√≥n)
- Auto-renovaci√≥n (s√≠/no)
- Acciones

Filtros:
- Por estado
- Por plan
- Por ciclo de facturaci√≥n
- Por cliente
- Por fecha de renovaci√≥n pr√≥xima

RF-ADMIN-037: Detalle de Suscripci√≥n
Vista completa:
- Informaci√≥n general
- Licencia asociada
- Plan contratado
- Addons activos
- Ciclo de facturaci√≥n
- Fechas de per√≠odo actual
- Pr√≥xima fecha de renovaci√≥n
- Auto-renovaci√≥n (toggle)
- M√©todo de pago
- Historial de pagos
- Facturas generadas
- Cambios de plan hist√≥ricos

RF-ADMIN-038: Cambio de Ciclo de Facturaci√≥n
Cliente puede cambiar de mensual a anual o viceversa:
- Desde detalle de suscripci√≥n, bot√≥n "Cambiar Ciclo"
- Opciones:
  - Mensual ‚Üí Anual
  - Anual ‚Üí Mensual
- C√°lculo prorrateado:
  - Si cambia a anual a mitad de mes:
    - D√≠as restantes del mes actual
    - Cobrar 11 meses + d√≠as proporcionales
    - Aplicar descuento anual
  - Si cambia a mensual desde anual:
    - Meses restantes del a√±o
    - Cr√©dito proporcional
    - Aplicar en siguientes facturas mensuales
- Mostrar claramente el c√°lculo
- Confirmar cambio
- Al confirmar:
  - Actualiza ciclo
  - Genera factura/nota de cr√©dito
  - Ajusta pr√≥ximas fechas de renovaci√≥n
  - Notifica al cliente

RF-ADMIN-039: Pausar Suscripci√≥n
Cliente puede pausar suscripci√≥n temporalmente:
- Desde detalle, bot√≥n "Pausar"
- Duraci√≥n de pausa (1-3 meses)
- Motivo (opcional)
- Durante pausa:
  - No se cobra
  - Acceso deshabilitado
  - Datos preservados
- Fecha de reactivaci√≥n autom√°tica
- O reactivaci√≥n manual
- Al pausar:
  - Estado: "Paused"
  - Deshabilita cobros autom√°ticos
  - Notifica al cliente
- Al reactivar:
  - Estado vuelve a "Active"
  - Restablece acceso
  - Reanuda cobros

RF-ADMIN-040: Cancelaci√≥n de Suscripci√≥n
(Ya cubierto parcialmente en RF-ADMIN-019, pero espec√≠fico de suscripci√≥n):
- Desde detalle de suscripci√≥n
- Opciones:
  - Inmediata (pierde acceso ahora)
  - Al final del per√≠odo (mantiene acceso hasta fecha de expiraci√≥n)
- Motivo obligatorio
- Encuesta de salida (enviar al cliente)
- Opciones de reembolso
- Al confirmar:
  - Marca auto-renovaci√≥n OFF
  - Deshabilita cobros futuros
  - Si inmediata: Bloquea acceso
  - Env√≠a email de despedida
  - Ofrece exportaci√≥n de datos
  - Actualiza m√©tricas de churn

================================================================================
M√ìDULO 4: FACTURACI√ìN SAAS
================================================================================

4.1 Facturaci√≥n Autom√°tica

RF-ADMIN-041: Proceso de Facturaci√≥n Recurrente Autom√°tico
- Sistema ejecuta proceso CRON diario a las 2:00 AM
- Identifica todas las suscripciones que renuevan HOY
- Para cada suscripci√≥n:
  - Verificar estado (activa, auto-renovaci√≥n ON)
  - Calcular monto total:
    - Plan base (mensual o anual)
    - Addons activos
    - Ajustes prorrateados (si hubo cambios en el mes)
    - Impuestos (IVA si aplica seg√∫n pa√≠s)
  - Generar factura con n√∫mero consecutivas
  - Intentar cobro con m√©todo de pago registrado
  - Registrar resultado (exitoso o fallido)
- Si cobro exitoso:
  - Marcar factura como "Pagada"
  - Extender per√≠odo de suscripci√≥n (+1 mes o +1 a√±o)
  - Actualizar fecha de pr√≥xima renovaci√≥n
  - Enviar recibo por email
  - Registrar transacci√≥n
  - Actualizar MRR/ARR
- Si cobro falla:
  - Marcar factura como "Pendiente"
  - Registrar motivo de fallo
  - Enviar email a cliente: "No pudimos procesar tu pago"
  - Notificar a equipo finance y sales
  - Programar reintento (d√≠a +3)
  - Mantener suscripci√≥n activa (per√≠odo de gracia)
- Generar reporte diario de facturaci√≥n con:
  - Facturas generadas
  - Cobros exitosos/fallidos
  - MRR del d√≠a
  - Problemas encontrados

RF-ADMIN-042: Pol√≠tica de Reintentos
Si pago falla en d√≠a 0 (renovaci√≥n):

D√≠a +3: Primer reintento autom√°tico
- Ejecuta proceso de cobro nuevamente
- Si exitoso: Todo resuelto
- Si falla: Enviar segundo recordatorio al cliente

D√≠a +5: Segundo reintento
- Si exitoso: Resuelto con advertencia al cliente
- Si falla: Alerta cr√≠tica a finance

D√≠a +7: Tercer reintento (√∫ltimo)
- Si exitoso: Resuelto
- Si falla: Suspender suscripci√≥n
  - Estado cambia a "Suspended"
  - Bloquea acceso del cliente
  - Email de suspensi√≥n
  - Per√≠odo de gracia adicional: 7 d√≠as para pagar antes de eliminaci√≥n

Cliente puede actualizar m√©todo de pago en cualquier momento
Al actualizar m√©todo de pago:
  - Si suscripci√≥n suspendida por pago: Reintentar cobro inmediatamente
  - Si exitoso: Reactivar autom√°ticamente

RF-ADMIN-043: Generaci√≥n de Facturas
Factura incluye:

Encabezado:
- Logo DevCorp
- Datos fiscales DevCorp (NIT, direcci√≥n, etc.)
- N√∫mero de factura (formato: NF-2026-00001)
- Fecha de emisi√≥n
- Fecha de vencimiento

Datos del cliente:
- Nombre comercial
- NIT/RIF
- Direcci√≥n
- Email de facturaci√≥n

Per√≠odo facturado:
- "Suscripci√≥n Plan Pro - Mensual"
- "Per√≠odo: 01 Feb 2026 - 28 Feb 2026"

Detalle de l√≠neas:
- Plan base (nombre, cantidad: 1, precio unitario, subtotal)
- Cada addon activo (nombre, cantidad, precio, subtotal)
- Ajustes prorrateados (si aplica):
  - Upgrade realizado (cr√©dito/cargo)
  - Descuentos aplicados
- Subtotal
- Impuestos (IVA 19% u otros seg√∫n pa√≠s)
- Total a pagar (destacado)

Informaci√≥n de pago:
- M√©todo de pago usado (√∫ltimos 4 d√≠gitos de tarjeta)
- ID de transacci√≥n
- Estado: Pagada / Pendiente / Vencida

Pie de factura:
- T√©rminos y condiciones
- Datos de contacto soporte

Formato: PDF profesional, responsive
Firmado digitalmente (opcional)
Env√≠o autom√°tico por email

RF-ADMIN-044: Facturaci√≥n Prorrateada

Escenario 1: Upgrade a mitad de per√≠odo
- Cliente tiene Plan Basic ($150k/mes)
- D√≠a 15 del mes hace upgrade a Pro ($350k/mes)
- C√°lculo:
  - D√≠as restantes del mes: 15 d√≠as
  - Costo Pro proporcional: ($350k / 30) √ó 15 = $175k
  - Cr√©dito Basic proporcional: ($150k / 30) √ó 15 = $75k
  - Cargo inmediato: $175k - $75k = $100k
- Sistema:
  - Genera factura inmediata por $100k
  - Cobra al m√©todo de pago
  - Si exitoso: Upgrade aplicado
  - Pr√≥xima factura (d√≠a 1 del siguiente mes): $350k completo

Escenario 2: Downgrade a mitad de per√≠odo
- Cliente tiene Plan Pro ($350k/mes)
- D√≠a 20 hace downgrade a Basic ($150k/mes)
- C√°lculo:
  - D√≠as restantes: 10 d√≠as
  - Cr√©dito Pro no usado: ($350k / 30) √ó 10 = $116.7k
  - Costo Basic proporcional: ($150k / 30) √ó 10 = $50k
  - Cr√©dito generado: $116.7k - $50k = $66.7k
- Sistema:
  - Genera nota de cr√©dito por $66.7k
  - Aplica cr√©dito a pr√≥xima factura
  - Pr√≥xima factura: $150k - $66.7k = $83.3k
  - Cliente informado del cr√©dito

RF-ADMIN-045: Dashboard de Facturaci√≥n
Vista unificada para equipo finance:

M√©tricas del mes:
- Total facturado (mes actual)
- Total cobrado (efectivo)
- Total pendiente de cobro
- Tasa de cobro exitoso (%)
- N√∫mero de facturas generadas
- N√∫mero de pagos fallidos

Gr√°ficos:
- Ingresos por mes (12 meses)
- Facturas pagadas vs pendientes (torta)
- Tasa de pagos exitosos (l√≠nea temporal)

Alertas:
- Facturas vencidas (listado)
- Pagos fallidos hoy
- Clientes con 3+ facturas pendientes
- Disputas/chargebacks abiertos

RF-ADMIN-046: Listado de Facturas
Tabla con todas las facturas:
- N√∫mero de factura
- Cliente
- Fecha emisi√≥n
- Monto
- Estado (badge con color)
- M√©todo de pago
- Acciones (ver, descargar PDF, reenviar email, marcar como pagada)

Filtros:
- Por estado (pendiente, pagada, vencida, anulada)
- Por cliente
- Por rango de fechas
- Por monto (mayor/menor a X)
- Por m√©todo de pago

Ordenar:
- Fecha (reciente/antigua)
- Monto (mayor/menor)
- Estado

Acciones masivas:
- Enviar recordatorio a seleccionadas
- Exportar selecci√≥n
- Marcar como pagadas (con confirmaci√≥n)

RF-ADMIN-047: Detalle de Factura
Vista completa:
- PDF embebido (visualizaci√≥n)
- Informaci√≥n completa de la factura
- Suscripci√≥n asociada
- Cliente asociado (link a perfil)
- Estado con historial de cambios
- M√©todo de pago usado
- Transacci√≥n(es) asociada(s)
- Intentos de cobro realizados
- Comunicaciones relacionadas (emails enviados)
- Acciones disponibles:
  - Descargar PDF
  - Reenviar por email
  - Marcar como pagada manualmente
  - Anular factura
  - Registrar pago parcial
  - Agregar nota interna

RF-ADMIN-048: Facturas Manuales
Crear factura manual (para casos especiales):
- Seleccionar cliente
- Tipo de factura:
  - Servicios profesionales
  - Implementaci√≥n personalizada
  - Capacitaci√≥n
  - Addon one-time
  - Ajuste manual
  - Otro
- L√≠neas de factura (agregar m√∫ltiples):
  - Descripci√≥n
  - Cantidad
  - Precio unitario
  - Subtotal (calculado)
- Subtotal
- Impuestos (seleccionar tasa)
- Total
- Fecha de emisi√≥n
- Fecha de vencimiento
- Observaciones internas
- M√©todo de pago esperado
- Generar factura
- Enviar al cliente (opcional)
- Registrar como pendiente de pago

RF-ADMIN-049: Anulaci√≥n de Facturas
Desde detalle de factura, bot√≥n "Anular":
- Solo facturas pendientes o pagadas (en ciertos casos)
- Motivo obligatorio:
  - Error en facturaci√≥n
  - Duplicada
  - Cliente cancel√≥ antes de cobro
  - Ajuste comercial
  - Otro (especificar)
- Si factura estaba pagada:
  - Opci√≥n de reembolso (s√≠/no)
  - Monto a reembolsar
- Confirmaci√≥n requerida
- Al anular:
  - Estado cambia a "Anulada"
  - Si hab√≠a pago: Procesar reembolso (si se eligi√≥)
  - Genera nota de cr√©dito
  - Ajusta m√©tricas (descuenta del MRR)
  - Notifica al cliente
  - Registra en auditor√≠a

RF-ADMIN-050: Notas de Cr√©dito
Generadas por:
- Anulaci√≥n de factura
- Devoluci√≥n parcial/total
- Ajustes comerciales
- Downgrade con cr√©dito

Contenido:
- N√∫mero de nota de cr√©dito
- Vinculada a factura original
- Monto del cr√©dito
- Raz√≥n del cr√©dito
- Aplicaci√≥n:
  - Reembolso inmediato
  - Aplicar a pr√≥xima(s) factura(s)
  - Mantener como cr√©dito disponible

Gesti√≥n:
- Listado de notas de cr√©dito
- Ver detalle
- Aplicar cr√©dito manualmente
- Reversar nota de cr√©dito (excepcional)

RF-ADMIN-051: Reportes de Facturaci√≥n
Reportes disponibles:

Reporte mensual de facturaci√≥n:
- Total facturado
- Total cobrado
- Total pendiente
- Tasa de cobro
- Desglose por plan

Reporte de ingresos reconocidos:
- Seg√∫n principio de causaci√≥n contable
- Ingresos diferidos (suscripciones anuales)
- Reconocimiento mensual

Reporte de morosidad:
- Facturas vencidas
- Antig√ºedad de facturas
- Clientes morosos
- Acciones de cobro realizadas

Reporte de m√©todos de pago:
- Distribuci√≥n por m√©todo
- Tasas de √©xito por m√©todo
- Comisiones por m√©todo

Proyecci√≥n de ingresos:
- MRR actual
- ARR actual
- Proyecci√≥n pr√≥ximos 3, 6, 12 meses
- Basado en tendencias

RF-ADMIN-052: Exportaci√≥n de Datos Fiscales
Para declaraciones y contabilidad externa:
- Exportar libro de ventas (Excel/CSV)
- Exportar facturas de per√≠odo (PDF batch)
- Formato DIAN (si aplica - Colombia)
- Formato para software contable (SIIGO, Alegra, etc.)
- Exportar notas de cr√©dito
- Exportar retenciones (si aplica)

================================================================================
M√ìDULO 5: GESTI√ìN DE PAGOS
================================================================================

5.1 M√©todos de Pago

RF-ADMIN-053: Dashboard de Pagos
Vista para equipo finance:

M√©tricas del d√≠a:
- Pagos procesados hoy
- Monto total recibido
- Pagos exitosos vs fallidos (%)
- Pagos pendientes de confirmaci√≥n

Alertas:
- Pagos rechazados en √∫ltima hora
- Disputas/chargebacks nuevos
- M√©todos de pago por expirar (tarjetas)

Gr√°ficos:
- Volumen de pagos diarios (√∫ltimos 30 d√≠as)
- Tasa de √©xito por m√©todo de pago
- Distribuci√≥n por m√©todo de pago

RF-ADMIN-054: Listado de Transacciones
Tabla completa de transacciones:
- ID de transacci√≥n
- Cliente
- Factura asociada
- Monto
- M√©todo de pago
- Estado (exitosa, fallida, pendiente, reembolsada)
- Fecha y hora
- Gateway/Pasarela usado
- ID de transacci√≥n de pasarela
- Acciones

Filtros:
- Por estado
- Por cliente
- Por m√©todo de pago
- Por pasarela
- Por rango de fechas
- Por monto

B√∫squeda:
- Por ID de transacci√≥n
- Por ID de factura
- Por referencia de pasarela

RF-ADMIN-055: Detalle de Transacci√≥n
Vista completa:
- Informaci√≥n general (ID, fecha, monto, estado)
- Cliente asociado (link)
- Factura asociada (link)
- M√©todo de pago usado
- Pasarela de pago utilizada
- ID de transacci√≥n en pasarela
- Request enviado a pasarela (JSON)
- Response recibida (JSON)
- C√≥digo de error (si fall√≥)
- Motivo de rechazo (si fall√≥)
- IP del cliente
- Metadata adicional
- Timeline de eventos
- Acciones:
  - Reintentar cobro (si fall√≥)
  - Procesar reembolso
  - Ver en dashboard de pasarela (link externo)
  - Exportar detalles

RF-ADMIN-056: Integraci√≥n con Pasarelas
Pasarelas soportadas:
- Wompi (Colombia): Principal
- PayU Latam: Alternativa
- Stripe: Internacional
- Mercado Pago: Futuro

Configuraci√≥n por pasarela:
- API Keys (p√∫blica y secreta)
- Webhook URL
- Modo (sandbox/producci√≥n)
- Moneda por defecto
- Comisiones
- Estado (activa/inactiva)

Flujo de pago:
1. Cliente registra m√©todo de pago en su portal
2. Sistema tokeniza con pasarela (no almacena datos de tarjeta completos)
3. Guarda token en BD
4. Al facturar: Usa token para cobrar
5. Pasarela procesa y responde
6. Sistema registra resultado
7. Si exitoso: Confirma pago
8. Si falla: Registra error e inicia reintentos

RF-ADMIN-057: Gesti√≥n de M√©todos de Pago de Clientes
Desde perfil de cliente, secci√≥n "M√©todos de Pago":
- Ver m√©todos registrados:
  - Tarjeta XXXX XXXX XXXX 4242 (Visa) - Expira 12/2026
  - Cuenta bancaria XXXXX123 (Bancolombia)
- M√©todo principal (marcado con badge)
- Acciones:
  - Ver detalles
  - Marcar como principal
  - Eliminar m√©todo
  - Solicitar actualizaci√≥n al cliente (env√≠a email)

RF-ADMIN-058: Reembolsos
Desde transacci√≥n o factura, bot√≥n "Reembolsar":
- Tipo de reembolso:
  - Total (monto completo)
  - Parcial (especificar monto)
- Motivo obligatorio:
  - Error de facturaci√≥n
  - Cliente insatisfecho
  - Cancelaci√≥n de servicio
  - Ajuste comercial
  - Disputa/chargeback
  - Otro (especificar)
- M√©todo:
  - Reembolso a m√©todo de pago original (autom√°tico)
  - Generar cr√©dito para pr√≥ximas facturas
  - Transferencia bancaria manual
- Confirmaci√≥n requerida
- Al procesar:
  - Env√≠a request a pasarela
  - Espera confirmaci√≥n
  - Actualiza estado de transacci√≥n
  - Genera nota de cr√©dito
  - Ajusta m√©tricas
  - Notifica al cliente
  - Registra en auditor√≠a

Tiempo de reembolso:
- Tarjetas: 5-10 d√≠as h√°biles
- Cuentas bancarias: 1-3 d√≠as h√°biles
- Seg√∫n pol√≠ticas de cada pasarela

RF-ADMIN-059: Disputas y Chargebacks
Cuando pasarela notifica disputa (v√≠a webhook):
- Sistema crea registro de disputa
- Notificaci√≥n inmediata a finance y legal
- Detalle de disputa:
  - Transacci√≥n original
  - Monto disputado
  - Motivo alegado por cliente
  - Fecha de la disputa
  - Fecha l√≠mite para responder
  - Estado: Abierta, En revisi√≥n, Ganada, Perdida
- Gesti√≥n:
  - Asignar responsable
  - Adjuntar evidencia (facturas, emails, logs de uso)
  - Agregar notas del caso
  - Enviar evidencia a pasarela (upload)
  - Seguimiento del caso
- Al resolverse:
  - Si ganada: Recuperar fondos
  - Si perdida: Registrar p√©rdida, considerar suspender cliente
  - Actualizar m√©tricas de disputas
  - Aprender del caso (agregar a base de conocimiento)

RF-ADMIN-060: Conciliaci√≥n Bancaria
Para finance:
- Importar extracto bancario (CSV/Excel)
- Mapear columnas (fecha, monto, referencia)
- Sistema busca transacciones coincidentes
- Match autom√°tico por monto y fecha (¬±2 d√≠as)
- Marcar como conciliadas
- Transacciones no conciliadas:
  - Revisar manualmente
  - Asignar a factura espec√≠fica
  - Marcar como "otro ingreso"
- Generar reporte de conciliaci√≥n:
  - Transacciones conciliadas
  - Transacciones pendientes
  - Diferencias encontradas

RF-ADMIN-061: Reportes de Pagos
- Reporte diario de transacciones
- Reporte de comisiones de pasarelas
- Reporte de reembolsos procesados
- Reporte de disputas y chargebacks
- An√°lisis de tasas de aprobaci√≥n por pasarela
- Tiempo promedio de procesamiento
- M√©todos de pago m√°s usados

================================================================================
M√ìDULO 6: SOPORTE T√âCNICO
================================================================================

6.1 Sistema de Tickets

RF-ADMIN-062: Dashboard de Soporte
Vista para equipo de support:

M√©tricas:
- Tickets abiertos
- Tickets en mi cola (asignados a m√≠)
- Tickets sin asignar
- Tickets resueltos hoy
- Tiempo promedio de primera respuesta
- Tiempo promedio de resoluci√≥n
- SLA en riesgo (pr√≥ximos a vencer)
- Tickets que violaron SLA
- CSAT promedio (satisfacci√≥n del cliente)

Alertas:
- Tickets cr√≠ticos sin respuesta
- Tickets escalados
- SLA por vencer (< 2 horas)

Gr√°ficos:
- Volumen de tickets (√∫ltimos 30 d√≠as)
- Tickets por categor√≠a (torta)
- Tickets por estado
- Tendencia de resoluci√≥n

RF-ADMIN-063: Listado de Tickets
Vista personalizable:

Vista "Mi Cola": Tickets asignados a m√≠
Vista "Sin Asignar": Tickets pendientes de asignaci√≥n
Vista "Todos": Todos los tickets

Tabla con columnas:
- N√∫mero de ticket
- Cliente
- Asunto
- Categor√≠a
- Prioridad (badge con color)
- Estado
- Asignado a
- √öltima respuesta (hace X tiempo)
- SLA restante (barra de progreso)
- Creado hace

Filtros:
- Por estado
- Por prioridad
- Por categor√≠a
- Por agente asignado
- Por cliente
- Por SLA (en riesgo, violado, cumpliendo)
- Por fecha de creaci√≥n

Acciones masivas:
- Asignar seleccionadas
- Cambiar prioridad
- Cerrar masivamente (con plantilla)

RF-ADMIN-064: Creaci√≥n de Ticket
Desde plataforma admin (en nombre del cliente):
- Cliente (b√∫squeda)
- Usuario del cliente que reporta (opcional)
- Categor√≠a:
  - T√©cnico (bugs, errores, performance)
  - Facturaci√≥n (problemas de pago, facturas)
  - Consulta (c√≥mo usar funcionalidad)
  - Feature Request (solicitud de nueva funcionalidad)
  - Bug Report (reporte de error)
  - Otro
- Prioridad:
  - Baja: No urgente
  - Media: Importante pero no urgente
  - Alta: Urgente, impacta operaci√≥n
  - Cr√≠tica: Sistema ca√≠do, bloqueante
- Asunto (1 l√≠nea)
- Descripci√≥n (detallada, markdown)
- Adjuntos (screenshots, logs, videos)
- Asignar a (seleccionar agente o dejar sin asignar)
- Tags personalizados
- Crear
- Al crear:
  - Genera n√∫mero de ticket (ej: #TK-12345)
  - Estado inicial: "Nuevo"
  - Registra timestamp
  - Si asignado: Notifica al agente
  - Si no asignado: A la cola general
  - Env√≠a email de confirmaci√≥n al cliente
  - Inicia timer de SLA

RF-ADMIN-065: Detalle de Ticket
Vista completa en 3 columnas:

Columna Izquierda: Informaci√≥n del Ticket
- N√∫mero de ticket
- Estado (dropdown para cambiar)
- Prioridad (dropdown)
- Categor√≠a (dropdown)
- Cliente (link a perfil)
- Usuario reportador (link)
- Asignado a (dropdown para reasignar)
- Creado hace X
- √öltima actualizaci√≥n hace X
- SLA:
  - Tiempo para primera respuesta (verde/amarillo/rojo)
  - Tiempo para resoluci√≥n (barra)
- Tags (agregar/quitar)

Columna Central: Conversaci√≥n
Thread de mensajes:
- Mensaje inicial del cliente
- Respuestas del agente
- Respuestas del cliente
- Notas internas (solo visibles para equipo DevCorp)
- Cada mensaje con:
  - Avatar del autor
  - Nombre y rol
  - Timestamp
  - Contenido (markdown rendered)
  - Adjuntos (mostrar inline si es imagen)
  - Botones: Responder, Citar, Reaccionar

Composer al final:
- Editor de texto enriquecido
- Opciones:
  - Responder a cliente (p√∫blico)
  - Agregar nota interna (privado)
- Adjuntar archivos
- Mencionar colegas (@nombre)
- Insertar template de respuesta (snippets)
- Botones:
  - Enviar
  - Enviar y cerrar
  - Enviar y marcar como resuelto

Columna Derecha: Contexto del Cliente
- Informaci√≥n del cliente:
  - Plan actual
  - Estado de licencia
  - D√≠as como cliente
  - √öltima actividad en sistema
  - N√∫mero de usuarios activos
  - Uso de recursos
- Tickets anteriores del cliente:
  - Lista de √∫ltimos 5 tickets
  - Ver todos (link)
- Actividad reciente:
  - √öltimos logins
  - Acciones recientes en sistema
- Art√≠culos relacionados de KB:
  - Sugerencias autom√°ticas seg√∫n asunto

RF-ADMIN-066: Asignaci√≥n de Tickets

Asignaci√≥n autom√°tica:
- Al crear ticket, si categor√≠a tiene equipo asignado:
  - T√©cnico ‚Üí Equipo t√©cnico
  - Facturaci√≥n ‚Üí Finance
  - Consulta ‚Üí Support general
- Round-robin entre agentes disponibles del equipo
- Considera carga actual de cada agente
- Evita asignar si agente est√° offline o ausente

Asignaci√≥n manual:
- Supervisor puede asignar a agente espec√≠fico
- Agente puede auto-asignarse tickets sin asignar
- Reasignar ticket a otro agente
- Escalar ticket a supervisor/especialista

Al asignar:
- Estado cambia a "Asignado"
- Agente recibe notificaci√≥n
- Inicia timer de respuesta

RF-ADMIN-067: Escalamiento de Tickets
Desde detalle, bot√≥n "Escalar":
- Escalar a:
  - Supervisor de soporte
  - Equipo t√©cnico (desarrollo)
  - Finance
  - Sales (si es comercial)
  - Gerencia (casos extremos)
- Motivo de escalamiento (obligatorio)
- Prioridad se puede aumentar autom√°ticamente
- Notifica al destinatario
- Cliente es informado: "Tu caso ha sido escalado a un especialista"
- Registra en historial

RF-ADMIN-068: Estados de Tickets
Flujo de estados:

Nuevo: Reci√©n creado, sin asignar
Asignado: Asignado a agente pero sin responder
Abierto: Agente respondi√≥, esperando m√°s info o trabajando
En Progreso: Agente trabajando activamente en soluci√≥n
Esperando Cliente: Agente pregunt√≥ algo, esperando respuesta del cliente
Resuelto: Soluci√≥n implementada, esperando confirmaci√≥n del cliente
Cerrado: Cliente confirm√≥ resoluci√≥n o auto-cerrado tras X d√≠as
Reabierto: Cliente indic√≥ que problema persiste

Cambios de estado:
- Agente puede cambiar estado en cualquier momento
- Ciertas transiciones requieren nota explicativa
- Al cambiar a "Resuelto": Enviar encuesta de satisfacci√≥n
- Auto-cerrado: Si est√° "Resuelto" por 7 d√≠as sin respuesta del cliente

RF-ADMIN-069: SLA (Service Level Agreement)
Configuraci√≥n de SLA por plan del cliente:

| Plan | Primera Respuesta | Resoluci√≥n |
|------|-------------------|------------|
| Trial | 48 horas | 7 d√≠as |
| Basic | 24 horas | 5 d√≠as |
| Pro | 12 horas | 3 d√≠as |
| Enterprise | 4 horas | 1 d√≠a |

SLA para prioridades:
- Cr√≠tica: Primera respuesta en 1 hora (todos los planes)
- Alta: Reducir tiempos a la mitad
- Media: SLA est√°ndar
- Baja: SLA extendido

Alertas de SLA:
- 75% del tiempo transcurrido: Alerta amarilla
- 90% del tiempo: Alerta naranja + notificar supervisor
- 100% (violaci√≥n): Alerta roja + escalamiento autom√°tico
- Registro de todas las violaciones de SLA para an√°lisis

RF-ADMIN-070: Templates de Respuesta (Snippets)
Respuestas pre-definidas para casos comunes:

Crear template:
- Nombre corto (ej: "reset-password")
- Asunto default (opcional)
- Contenido (markdown)
- Variables din√°micas: {{customer_name}}, {{company_name}}, etc.
- Categor√≠a
- Adjuntos default

Usar template:
- Al componer respuesta, escribir "/" + nombre
- O seleccionar de lista
- Sistema inserta contenido
- Reemplaza variables autom√°ticamente
- Agente puede editar antes de enviar

Templates comunes:
- "C√≥mo resetear contrase√±a"
- "Problema de pago - actualizar m√©todo"
- "Feature no disponible en tu plan"
- "Reportar bug - informaci√≥n requerida"
- "Ticket resuelto - cierre"

RF-ADMIN-071: Base de Conocimientos (Knowledge Base)
Sistema de art√≠culos de ayuda:

Para clientes (p√∫blico):
- Categor√≠as:
  - Primeros Pasos
  - Inventario
  - Ventas
  - Contabilidad
  - N√≥mina
  - Preguntas Frecuentes
  - Soluci√≥n de Problemas
- Por cada art√≠culo:
  - T√≠tulo
  - Contenido (markdown, con im√°genes)
  - Videos embebidos (YouTube/Vimeo)
  - Categor√≠a
  - Tags
  - Visibilidad (p√∫blico/privado)
  - Estado (publicado/borrador)
  - √öltima actualizaci√≥n
- Funcionalidades:
  - B√∫squeda full-text
  - Art√≠culos relacionados
  - "¬øTe fue √∫til este art√≠culo?" (s√≠/no)
  - Contador de vistas
  - Comentarios (opcional)

Para equipo interno (privado):
- Runbooks: Procedimientos internos
- Scripts de soluci√≥n de problemas
- Informaci√≥n t√©cnica
- Solo visible para equipo DevCorp

RF-ADMIN-072: Gesti√≥n de Knowledge Base
Desde admin:

Crear art√≠culo:
- Editor WYSIWYG
- Upload de im√°genes
- Embed de videos
- Syntax highlighting para c√≥digo
- Previsualizaci√≥n

Editar art√≠culo
Archivar (no eliminar)
Organizar en categor√≠as (drag & drop)
Destacar art√≠culos importantes

M√©tricas por art√≠culo:
- Vistas totales
- Vistas √∫nicas
- % de utilidad (likes/dislikes)
- Tiempo promedio de lectura
- Tickets que enlazaron a este art√≠culo

Art√≠culos m√°s vistos
Art√≠culos menos √∫tiles (candidatos a mejorar)

RF-ADMIN-073: Vinculaci√≥n de Tickets con KB
Al responder ticket:
- Opci√≥n de enlazar art√≠culo relevante
- Cliente recibe link en la respuesta
- Sistema registra:
  - Qu√© art√≠culo resolvi√≥ qu√© tipo de problema
  - Efectividad de art√≠culos

Al cerrar ticket:
- Sugerir crear art√≠culo de KB si es problema com√∫n
- Opci√≥n de convertir respuesta en art√≠culo

RF-ADMIN-074: Chat en Vivo (Opcional)
Integraci√≥n de chat en tiempo real:
- Widget en portal del cliente
- Cliente inicia chat
- Entra a cola de chats
- Agente disponible toma el chat
- Conversaci√≥n en tiempo real
- Typing indicators
- Adjuntos
- Emojis

Al finalizar:
- Opci√≥n de convertir en ticket (si no se resolvi√≥)
- Guardar transcripci√≥n
- Enviar transcripci√≥n al cliente por email

Horario de atenci√≥n:
- Dentro de horario: Chat activo
- Fuera de horario: Formulario para crear ticket

RF-ADMIN-075: Satisfacci√≥n del Cliente (CSAT)
Al cerrar o resolver ticket:
- Email autom√°tico con encuesta:
  - "¬øSe resolvi√≥ tu problema?" (S√≠/No)
  - "Califica la atenci√≥n recibida" (1-5 estrellas)
  - "¬øQu√© podr√≠amos mejorar?" (texto opcional)

Respuestas se registran
M√©tricas:
- CSAT promedio (% de satisfacci√≥n)
- CSAT por agente
- CSAT por categor√≠a
- Evoluci√≥n en el tiempo

Alertas:
- Calificaci√≥n negativa (‚â§2 estrellas): Notificar a supervisor
- Tendencia negativa de agente: Review

RF-ADMIN-076: Reportes de Soporte
Reportes disponibles:

Resumen de soporte (mensual):
- Tickets creados vs cerrados
- Tiempo promedio de respuesta
- Tiempo promedio de resoluci√≥n
- SLA compliance (%)
- CSAT promedio
- Top 10 problemas

Performance de agentes:
- Tickets resueltos por agente
- Tiempos promedio por agente
- CSAT por agente
- Violaciones de SLA
- Comparativa entre agentes

An√°lisis de categor√≠as:
- Volumen por categor√≠a
- Tiempo de resoluci√≥n por categor√≠a
- Tasa de resoluci√≥n en primera respuesta

Tendencias:
- Tipos de problemas emergentes
- Picos de volumen (horas/d√≠as)
- Estacionalidad

Exportaci√≥n a PDF/Excel

================================================================================
M√ìDULO 7: DISTRIBUCI√ìN DE APPS
================================================================================

7.1 Gesti√≥n de Releases

RF-ADMIN-077: Dashboard de Distribuci√≥n
Vista de releases de apps:

Apps gestionadas:
- NexFlow Business (Empresarial)
  - Android
  - iOS
  - Windows
  - macOS
  - Linux
- NexFlow Client (Cliente Final)
  - Android
  - iOS
  - Web (se actualiza autom√°ticamente)

Por cada plataforma:
- Versi√≥n actual en producci√≥n
- Versi√≥n en beta (si existe)
- √öltima actualizaci√≥n
- N√∫mero de descargas
- Usuarios activos

RF-ADMIN-078: Upload de Nueva Versi√≥n
Para subir nueva release:

Seleccionar app (Business o Client)
Seleccionar plataforma

Informaci√≥n de la versi√≥n:
- N√∫mero de versi√≥n: (semantic versioning: 2.1.3)
- Tipo de release:
  - Major (cambios grandes, breaking)
  - Minor (nuevas features)
  - Patch (bug fixes)
- Canal de distribuci√≥n:
  - Production (p√∫blico general)
  - Beta (testers)
  - Alpha (interno DevCorp)
- Release notes (markdown):
  - Nuevas caracter√≠sticas
  - Mejoras
  - Correcciones de bugs
  - Problemas conocidos
- Fecha de release: Hoy o programar
- Obligatoria: S√≠/No (fuerza actualizaci√≥n)

Upload de archivo:
- Android: .apk o .aab
- iOS: .ipa (o link a TestFlight/App Store)
- Windows: .exe (installer)
- macOS: .dmg
- Linux: .AppImage o .deb
- Validaciones:
  - Tama√±o m√°ximo (configurable, ej: 500MB)
  - Formato correcto
  - Nombre de archivo con versi√≥n

Metadata:
- Tama√±o del archivo (calculado)
- Checksum (MD5/SHA256) para verificaci√≥n
- Build number (auto-incremental)

Confirmar upload
Al confirmar:
- Sube archivo a Supabase Storage
- Genera URL p√∫blica o firmada (temporal)
- Registra en tabla `app_versions`
- Genera notificaci√≥n (si hay que avisar a clientes)
- Actualiza dashboard

RF-ADMIN-079: Listado de Versiones
Por cada app y plataforma:
Tabla con historial de versiones:
- Versi√≥n
- Canal (prod/beta/alpha)
- Fecha de release
- Tama√±o
- Descargas
- Estado (activa, archivada)
- Acciones (descargar, ver release notes, archivar, eliminar)

Ordenar por fecha (m√°s reciente arriba)
Filtrar por canal

RF-ADMIN-080: Detalle de Versi√≥n
Vista completa:

Informaci√≥n general
Release notes (formatted)

Archivo:
- Nombre
- Tama√±o
- Checksum
- URL de descarga (con bot√≥n copiar)

Estad√≠sticas:
- Descargas totales
- Descargas por d√≠a (gr√°fico)
- Clientes que la tienen instalada (si reportan)
- Crashes reportados (si hay telemetr√≠a)

Canal y visibilidad
Fecha de publicaci√≥n
Publicada por (usuario DevCorp)

Acciones:
- Descargar archivo
- Copiar URL p√∫blica
- Cambiar a otro canal (promover beta ‚Üí prod)
- Archivar
- Eliminar (con confirmaci√≥n)

RF-ADMIN-081: Portal de Descargas P√∫blico
P√°gina p√∫blica: nexflow.app/downloads

Mostrar versiones de producci√≥n
Por app (Business / Client):
- Descripci√≥n breve
- Versi√≥n actual
- Fecha de √∫ltima actualizaci√≥n
- Release notes (colapsable)
- Botones de descarga por plataforma:
  - ü§ñ Android (descarga directa APK)
  - üçé iOS (link a App Store)
  - ü™ü Windows (descarga EXE)
  - üçé macOS (descarga DMG)
  - üêß Linux (descarga AppImage)
- Requisitos del sistema
- Instrucciones de instalaci√≥n

FAQ sobre instalaci√≥n
Link a soporte

RF-ADMIN-082: Portal de Descargas Privado (para clientes)
Desde portal del cliente empresarial:

Secci√≥n "Descargar Aplicaciones"
Mostrar solo apps relevantes para ese cliente:
- Si es cliente Enterprise: Acceso a beta opcional
- Si es trial/basic: Solo producci√≥n

Botones de descarga
Historial de descargas del cliente
Auto-update check (si app lo soporta)

RF-ADMIN-083: Distribuci√≥n en Stores

Android (Google Play):
- Link a Play Store desde portal
- Estad√≠sticas de Play Console (manual)
- Notas sobre proceso de publicaci√≥n

iOS (App Store):
- Link a App Store
- TestFlight para betas
- Notas sobre Apple Review process

RF-ADMIN-084: Notificaciones de Actualizaci√≥n
Al publicar nueva versi√≥n:

Si es major/minor: Notificar a todos los clientes
  - Email: "Nueva versi√≥n disponible de NexFlow Business"
  - Notificaci√≥n in-app
  - Banner en portal del cliente

Si es patch: Notificaci√≥n silenciosa (solo in-app)

Si es obligatoria: Forzar actualizaci√≥n
  - App muestra modal al abrir
  - "Versi√≥n obsoleta. Actualiza para continuar."
  - Bot√≥n "Actualizar Ahora" ‚Üí descarga

RF-ADMIN-085: Auto-Update (Futuro)
Mecanismo de actualizaci√≥n autom√°tica:

App verifica versi√≥n al iniciar
Compara con API: GET /api/v1/versions/check?platform=android&current=2.1.2

Respuesta:
  - {update_available: true, latest_version: "2.1.3", mandatory: false, download_url: "..."}

Si hay actualizaci√≥n:
  - Notificar al usuario
  - Opci√≥n de "Actualizar Ahora" o "Despu√©s"
  - Si es obligatoria: Bloquear uso hasta actualizar

Descarga e instala (seg√∫n plataforma)

RF-ADMIN-086: Rollback de Versi√≥n
Si nueva versi√≥n tiene bugs cr√≠ticos:

Desde detalle de versi√≥n problem√°tica
Bot√≥n "Rollback"
Confirmaci√≥n:
  - ‚ö†Ô∏è "Esto marcar√° la versi√≥n anterior como actual"
  - ‚ö†Ô∏è "Los clientes recibir√°n notificaci√≥n"

Al confirmar:
  - Versi√≥n actual se marca como "Retirada"
  - Versi√≥n anterior se marca como "Actual"
  - Se env√≠a notificaci√≥n a clientes
  - "Por favor actualiza a la versi√≥n 2.1.2 (estable)"

RF-ADMIN-087: Changelog P√∫blico
P√°gina p√∫blica: nexflow.app/changelog

Listado de todas las versiones (√∫ltimas primeras)

Por cada versi√≥n:
- N√∫mero de versi√≥n
- Fecha de release
- Release notes (formatted)
- Plataformas afectadas

Feed RSS para seguir actualizaciones
Filtrar por plataforma
Buscar en changelog

RF-ADMIN-088: Reportes de Distribuci√≥n
- Descargas por versi√≥n
- Descargas por plataforma
- Adopci√≥n de versiones (% de usuarios en cada versi√≥n)
- Tiempo promedio de actualizaci√≥n (cu√°nto tardan usuarios en actualizar)
- Tasa de actualizaci√≥n (% que actualiz√≥ en X d√≠as)
- Versiones en uso actualmente (fragmentaci√≥n)

================================================================================
M√ìDULO 8: ANALYTICS Y M√âTRICAS SAAS
================================================================================

8.1 Dashboard Ejecutivo

RF-ADMIN-089: Vista General de M√©tricas de Negocio
Dashboard principal para founders/executives:

Secci√≥n: M√©tricas de Ingresos

MRR (Monthly Recurring Revenue):
- Valor actual
- Crecimiento vs mes anterior ($, %)
- Gr√°fico de evoluci√≥n (12 meses)
- Desglose:
  - New MRR (nuevos clientes)
  - Expansion MRR (upgrades)
  - Contraction MRR (downgrades)
  - Churned MRR (cancelaciones)
  - Net New MRR (new + expansion - contraction - churned)

ARR (Annual Recurring Revenue):
- MRR √ó 12
- Proyecci√≥n

ARPU (Average Revenue Per User):
- MRR total / # clientes
- Por plan
- Tendencia

Secci√≥n: M√©tricas de Clientes

Total de clientes:
- Activos
- En trial
- Cancelados (lifetime)

Nuevos clientes este mes:
- N√∫mero
- Tasa de crecimiento
- Por canal de adquisici√≥n

Churn Rate:
- % de clientes que cancelaron este mes
- Customer churn vs Revenue churn
- Gr√°fico de tendencia
- Comparativa con industry benchmark

LTV (Lifetime Value):
- Valor promedio de un cliente durante su vida
- F√≥rmula: ARPU / Churn Rate (simplified)
- Por plan

Retention Rate:
- % de clientes que renovaron
- Cohortes de retenci√≥n (gr√°fico)
- Retenci√≥n por mes de adquisici√≥n

Secci√≥n: M√©tricas de Adquisici√≥n

CAC (Customer Acquisition Cost):
- (Gastos de Marketing + Ventas) / Nuevos Clientes
- Por canal
- Tendencia

LTV / CAC Ratio:
- Ideal: > 3
- Por plan
- Alerta si < 1 (no rentable)

Payback Period:
- Meses para recuperar CAC
- Ideal: < 12 meses

Trial to Paid Conversion Rate:
- % de trials que se convirtieron en pagos
- Por plan destino
- Tendencia

Secci√≥n: M√©tricas de Producto

DAU (Daily Active Users):
- Usuarios que usaron el sistema hoy
- Gr√°fico de 30 d√≠as

MAU (Monthly Active Users):
- Usuarios √∫nicos del mes

DAU/MAU Ratio:
- Stickiness del producto
- Ideal: > 20%

Engagement:
- Sesiones promedio por usuario
- Duraci√≥n promedio de sesi√≥n
- Features m√°s usadas

Transacciones procesadas:
- Total del mes
- Promedio por cliente
- Crecimiento

Secci√≥n: Salud del Negocio

Burn Rate: Gasto mensual
Runway: Meses de operaci√≥n con efectivo actual
Gross Margin: (MRR - Costos Directos) / MRR
Quick Ratio: (New MRR + Expansion) / (Contraction + Churned)
  - Ideal: > 4

RF-ADMIN-090: Gr√°ficos Interactivos
Todos los gr√°ficos son interactivos:
- Hover para ver valores exactos
- Zoom in/out
- Filtrar por rango de fechas
- Exportar como imagen (PNG)
- Exportar datos (CSV)
- Comparar per√≠odos (este mes vs mes pasado)

RF-ADMIN-091: Cohortes de Clientes
An√°lisis de cohortes:

Tabla de retenci√≥n por mes de adquisici√≥n

| Mes Adq. | Mes 0 | Mes 1 | Mes 2 | Mes 3 | ... | Mes 12 |
|----------|-------|-------|-------|-------|-----|--------|
| Ene 2026 | 100%  | 95%   | 92%   | 88%   | ... | 75%    |
| Feb 2026 | 100%  | 93%   | 90%   | ...   | ... | ...    |

Visualizaci√≥n con heatmap (colores)
Insights: ¬øQu√© cohortes tienen mejor retenci√≥n?

RF-ADMIN-092: An√°lisis de Churn
Deep dive en cancelaciones:

Churn rate por segmento:
- Por plan (Basic cancela m√°s que Pro?)
- Por industria
- Por tama√±o de empresa
- Por regi√≥n

Motivos de cancelaci√≥n:
- Gr√°fico de torta
- Top 5 motivos

Timing de cancelaci√≥n:
- ¬øEn qu√© mes cancelan m√°s? (mes 1, 3, 6?)
- Churn curve

Valor perdido:
- MRR perdido por churn este mes
- LTV de clientes que cancelaron

Predicci√≥n de churn:
- Score de riesgo por cliente (machine learning futuro)
- Clientes en riesgo alto (lista)

RF-ADMIN-093: An√°lisis de Crecimiento

Tasa de crecimiento mensual (MoM):
- MRR growth %
- Clientes growth %

Comparativa YoY:
- Este mes vs mismo mes a√±o anterior

Proyecciones:
- MRR en 3, 6, 12 meses
- Escenarios: Optimista, Realista, Pesimista
- Basado en tendencias hist√≥ricas

Rule of 40:
- Growth Rate % + Profit Margin %
- Benchmark de SaaS saludables

RF-ADMIN-094: An√°lisis por Plan
Comparativa entre planes:

- Distribuci√≥n de clientes por plan
- MRR por plan
- Churn rate por plan
- LTV por plan
- ARPU por plan
- Upgrade/Downgrade flows:
  - Cu√°ntos clientes hicieron upgrade
  - De qu√© plan a qu√© plan
  - Cu√°nto tiempo tardaron en upgrade

RF-ADMIN-095: An√°lisis de Canales de Adquisici√≥n

Clientes por canal:
- Org√°nico (SEO)
- Paid (Google Ads, Facebook Ads)
- Referidos
- Ventas directas
- Partnerships
- Eventos
- Otros

CAC por canal
LTV por canal

ROI por canal: (LTV - CAC) / CAC
Mejor canal = mayor ROI

RF-ADMIN-096: Reportes Exportables
Generar reportes en PDF:
- Reporte ejecutivo mensual
- Reporte trimestral para board
- Reporte anual
- Contenido personalizable
- Branding de DevCorp
- Gr√°ficos embebidos
- Env√≠o autom√°tico por email a stakeholders

================================================================================
9. COMUNICACI√ìN ENTRE PLATAFORMAS
================================================================================

9.1 Arquitectura de Comunicaci√≥n

COMUNICACI√ìN ENTRE PLATAFORMAS

NEXFLOW ADMIN (Esta App) <-> NEXFLOW BUSINESS (Cliente ERP)

Event Bus (Redis Pub/Sub)

SHARED SERVICES LAYER:
- Tenant Service
- License Service
- Billing Service
- Support Service
- Analytics Service

API REST / WebSocket

NEXFLOW CLIENT APP (Portal B2B)

API REST

PUBLIC WEBSITE (Marketing/Landing)

Webhook

EXTERNAL SERVICES:
- Payment Gateways
- Email Services
- SMS Services
- Analytics Tools

9.2 Eventos del Sistema (Event Bus)

Eventos de Licencia:
{
  "event": "license_activated",
  "tenant_id": "queseria_dg_001",
  "license_id": "LIC-2026-123456",
  "plan": "pro",
  "activated_by": "admin@devcorp.com",
  "timestamp": "2026-01-15T10:30:00Z"
}

Eventos de Facturaci√≥n:
{
  "event": "payment_received",
  "tenant_id": "queseria_dg_001",
  "invoice_id": "INV-2026-789012",
  "amount": 299000,
  "currency": "COP",
  "payment_method": "credit_card",
  "status": "success",
  "timestamp": "2026-01-15T14:20:00Z"
}

Eventos de Soporte:
{
  "event": "ticket_created",
  "tenant_id": "queseria_dg_001",
  "ticket_id": "SUP-2026-345678",
  "priority": "high",
  "category": "technical",
  "subject": "Error en c√°lculo de inventario",
  "timestamp": "2026-01-15T16:45:00Z"
}

9.3 APIs y Endpoints

API REST para NexFlow Business:

GET /api/v1/admin/tenants/{tenant_id}/metrics
‚Üí Retorna m√©tricas de uso del cliente

POST /api/v1/admin/tenants/{tenant_id}/suspend
‚Üí Suspende acceso del cliente

PUT /api/v1/admin/tenants/{tenant_id}/limits
‚Üí Actualiza l√≠mites de licencia

GET /api/v1/admin/invoices/{tenant_id}
‚Üí Lista facturas del cliente

POST /api/v1/admin/support/tickets
‚Üí Crea ticket de soporte para cliente

Webhooks para comunicaci√≥n bidireccional:
- NexFlow Business ‚Üí Admin: Reporte de uso, errores cr√≠ticos
- Admin ‚Üí NexFlow Business: Cambios de licencia, actualizaciones
- Admin ‚Üí Client Portal: Actualizaciones de pedidos, estados

9.4 Flujos de Comunicaci√≥n Cr√≠ticos

Flujo 1: Activaci√≥n de Licencia
1. Admin activa licencia en NexFlow Admin
2. License Service publica evento "license_activated"
3. Tenant Service actualiza estado del cliente
4. Notification Service env√≠a email al cliente
5. NexFlow Business recibe evento y habilita acceso
6. Analytics Service registra m√©trica

Flujo 2: Pago de Factura
1. Cliente paga factura (pasarela externa)
2. Payment Gateway env√≠a webhook a Billing Service
3. Billing Service valida y actualiza estado
4. Evento "payment_received" se publica
5. License Service extiende per√≠odo si aplica
6. Notification Service confirma al cliente
7. Analytics Service actualiza m√©tricas financieras

Flujo 3: Ticket Cr√≠tico
1. Cliente crea ticket con prioridad "cr√≠tica"
2. Support Service recibe y eval√∫a
3. Evento "critical_ticket_created" se dispara
4. Notification Service alerta a equipo de soporte
5. Dashboard de Admin muestra alerta roja
6. Si SLA se acerca a vencer, se escala autom√°ticamente

================================================================================
10. SEGURIDAD Y PERMISOS
================================================================================

10.1 Permisos Granulares por Rol

| M√≥dulo | Super Admin | Sales Manager | Support Agent | Finance Manager | DevOps |
|--------|-------------|---------------|---------------|-----------------|--------|
| Clientes | CRUD | CRU | R | R | R |
| Licencias | CRUD | CRU | R | R | R |
| Facturaci√≥n | CRUD | R | R | CRUD | R |
| Soporte | CRUD | R | CRUD | R | R |
| M√©tricas | R | R | R | R | R |
| Configuraci√≥n | CRUD | R | R | R | CRU |
| Monitoreo | R | R | R | R | CRUD |
| Backups | CRUD | R | R | R | CRUD |

10.2 Auditor√≠a Completa

RF-ADMIN-101: Log de Auditor√≠a Admin
Todas las acciones se registran con:
- Usuario que realiz√≥ la acci√≥n
- Rol del usuario
- IP origen
- Timestamp exacto
- Acci√≥n espec√≠fica
- Recurso afectado
- Valores antes/despu√©s (para cambios)
- Resultado (√©xito/error)

RF-ADMIN-102: Reportes de Auditor√≠a
- Por usuario: Todas las acciones de un admin
- Por recurso: Historial de un cliente/licencia
- Por per√≠odo: Actividad diaria/semanal/mensual
- Por tipo: Solo modificaciones, solo accesos, etc.

================================================================================
11. M√ìTRICAS Y KPIs ESPEC√çFICOS DE ADMIN
================================================================================

11.1 Dashboard de Admin Espec√≠fico

RF-ADMIN-103: M√©tricas de Eficiencia Operativa
- Tiempo promedio de onboarding: X d√≠as
- Tickets resueltos por agente: Ranking
- Facturas generadas por d√≠a: XX
- Tasa de √©xito de pagos: XX%
- Tiempo de respuesta de soporte: X horas

RF-ADMIN-104: Alertas Operativas
- Sistema: Todos los servicios operational
- Backups: 2 archivos pendientes de backup
- Email: Queue con 150 emails pendientes
- Pagos: 3 facturas vencidas por cobrar
- Soporte: 5 tickets cr√≠ticos sin resolver

RF-ADMIN-105: M√©tricas de Cliente √önico
Por cada cliente, mostrar en su perfil:
- Health Score: 0-100 (basado en uso, pagos, tickets)
- Churn Risk: Bajo/Medio/Alto
- Upsell Probability: % basado en uso de l√≠mites
- NPS Trend: Evoluci√≥n del Net Promoter Score

================================================================================
FIN DEL DOCUMENTO DE REQUISITOS FUNCIONALES
================================================================================
Documento preparado para NexFlow Admin v1.0
Desarrollado por: Devin Polanco Romero - DevCorp
Enero 2026
